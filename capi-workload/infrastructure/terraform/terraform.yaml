apiVersion: infra.contrib.fluxcd.io/v1alpha2
kind: Terraform
metadata:
  name: aks-infra
  namespace: flux-system
spec:
  approvePlan: auto
  interval: 5m
  path: ./terraform/
  sourceRef:
    kind: GitRepository
    name: flux-system
    namespace: flux-system
  varsFrom:
    - kind: Secret
      name: azure-cluster-identity
      varsKeys:
        - subscriptionID:TF_VAR_subscription_id
        - tenantID:TF_VAR_tenant_id
        - clientID:TF_VAR_client_id
        - clientSecret:TF_VAR_client_secret
        - location:TF_VAR_location
        - resourceGroupName:TF_VAR_resource_group_name
        - servicePrincipalName:TF_VAR_service_principal_name
  # Terraform outputs will be written to the specified Kubernetes Secret,
  # allowing other resources to consume these outputs as needed.
  writeOutputsToSecret:
    name: terraform-outputs
  serviceAccountName: terraform-runner
